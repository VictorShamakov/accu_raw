---
title: "AST notcorr_kmdclust3"
author: "SVA"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    css: "styles.css"
    code_folding: hide
    df_print: paged
    toc: yes
    toc_depth: 4
    toc_float:
      collapsed: no
  word_document:
    toc: yes
    toc_depth: '4'
editor_options:
  chunk_output_type: inline
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  include = TRUE,
  message = FALSE, 
  warning = FALSE
)

rm(list=ls())
load("./data/envs/1_desc_stat/sp_results.RData")
source("functions.R")
```

<script>
function addClassToTitle(containerId, className) {
  // Находим контейнер по id
  var container = document.getElementById(containerId);
  if (!container) {
    console.warn('Контейнер с id "' + containerId + '" не найден.');
    return;
  }

  // Добавляем класс к найденному h3
  container.classList.add(className);
}
</script>


```{r}
load("./data/envs/4_cluster_analysis/df.acc.male.RData")
df$gender <- factor(df$gender, labels = "M")

# df.acc <- df.acc[df.acc$gender == "F", ]
```


```{r}
sp_results <- select(sp_results, userid, starts_with("BFST"), starts_with("MROT"), starts_with("KOT"), starts_with("VIT"), starts_with("LC"), starts_with("SOA"))
names(sp_results) <- tolower(names(sp_results))
```

```{r}
df <- merge(df, sp_results, by.x = "user_id", by.y = "userid")
```



```{r}
sign_differences <- list()
```

## Описательная статистика 

### notcorr_kmdclust3 {.tabset .tabset-fade .tabset-pills}

#### Table
```{r}
table(df$notcorr_kmdclust3)
```

#### Barplot
```{r}
ggplot(df, aes(notcorr_kmdclust3, fill=notcorr_kmdclust3)) + geom_bar()
```






























### bfst_extraversion {.tabset .tabset-fade .tabset-pills}
**Экстраверсия**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$bfst_extraversion, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "bfst_extraversion"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$bfst_extraversion, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Экстраверсия", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$bfst_extraversion);print(st)
check_normal_distribution(st)
ks <- ks.test(df$bfst_extraversion, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(bfst_extraversion)$statistic,
          p.value = shapiro.test(bfst_extraversion)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = bfst_extraversion)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - bfst_extraversion", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(bfst_extraversion ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(bfst_extraversion ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, bfst_extraversion ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$bfst_extraversion)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$bfst_extraversion, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$bfst_extraversion, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "bfst_extraversion")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('bfst_extraversion', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=bfst_extraversion, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### bfst_benevolence {.tabset .tabset-fade .tabset-pills}
**Доброжелательность**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$bfst_benevolence, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "bfst_benevolence"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$bfst_benevolence, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Доброжелательность", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$bfst_benevolence);print(st)
check_normal_distribution(st)
ks <- ks.test(df$bfst_benevolence, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(bfst_benevolence)$statistic,
          p.value = shapiro.test(bfst_benevolence)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = bfst_benevolence)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - bfst_benevolence", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(bfst_benevolence ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(bfst_benevolence ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, bfst_benevolence ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$bfst_benevolence)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$bfst_benevolence, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$bfst_benevolence, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "bfst_benevolence")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('bfst_benevolence', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=bfst_benevolence, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### bfst_conscientiousness {.tabset .tabset-fade .tabset-pills}
**Добросовестность**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$bfst_conscientiousness, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "bfst_conscientiousness"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$bfst_conscientiousness, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Добросовестность", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$bfst_conscientiousness);print(st)
check_normal_distribution(st)
ks <- ks.test(df$bfst_conscientiousness, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(bfst_conscientiousness)$statistic,
          p.value = shapiro.test(bfst_conscientiousness)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = bfst_conscientiousness)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - bfst_conscientiousness", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(bfst_conscientiousness ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(bfst_conscientiousness ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, bfst_conscientiousness ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$bfst_conscientiousness)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$bfst_conscientiousness, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$bfst_conscientiousness, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "bfst_conscientiousness")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('bfst_conscientiousness', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=bfst_conscientiousness, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### bfst_neuroticism {.tabset .tabset-fade .tabset-pills}
**Нейротизм**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$bfst_neuroticism, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "bfst_neuroticism"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$bfst_neuroticism, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Нейротизм", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$bfst_neuroticism);print(st)
check_normal_distribution(st)
ks <- ks.test(df$bfst_neuroticism, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(bfst_neuroticism)$statistic,
          p.value = shapiro.test(bfst_neuroticism)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = bfst_neuroticism)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - bfst_neuroticism", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(bfst_neuroticism ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(bfst_neuroticism ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, bfst_neuroticism ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$bfst_neuroticism)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$bfst_neuroticism, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$bfst_neuroticism, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "bfst_neuroticism")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('bfst_neuroticism', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=bfst_neuroticism, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### bfst_openness {.tabset .tabset-fade .tabset-pills}
**Открытость**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$bfst_openness, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "bfst_openness"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$bfst_openness, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Открытость", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$bfst_openness);print(st)
check_normal_distribution(st)
ks <- ks.test(df$bfst_openness, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(bfst_openness)$statistic,
          p.value = shapiro.test(bfst_openness)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = bfst_openness)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - bfst_openness", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(bfst_openness ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(bfst_openness ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, bfst_openness ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$bfst_openness)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$bfst_openness, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$bfst_openness, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "bfst_openness")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('bfst_openness', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=bfst_openness, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### bfst_sociability {.tabset .tabset-fade .tabset-pills}
**Общительность**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$bfst_sociability, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "bfst_sociability"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$bfst_sociability, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Общительность", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$bfst_sociability);print(st)
check_normal_distribution(st)
ks <- ks.test(df$bfst_sociability, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(bfst_sociability)$statistic,
          p.value = shapiro.test(bfst_sociability)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = bfst_sociability)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - bfst_sociability", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(bfst_sociability ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(bfst_sociability ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, bfst_sociability ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$bfst_sociability)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$bfst_sociability, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$bfst_sociability, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "bfst_sociability")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('bfst_sociability', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=bfst_sociability, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### bfst_persistence {.tabset .tabset-fade .tabset-pills}
**Настойчивость**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$bfst_persistence, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "bfst_persistence"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$bfst_persistence, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Настойчивость", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$bfst_persistence);print(st)
check_normal_distribution(st)
ks <- ks.test(df$bfst_persistence, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(bfst_persistence)$statistic,
          p.value = shapiro.test(bfst_persistence)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = bfst_persistence)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - bfst_persistence", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(bfst_persistence ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(bfst_persistence ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, bfst_persistence ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$bfst_persistence)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$bfst_persistence, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$bfst_persistence, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "bfst_persistence")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('bfst_persistence', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=bfst_persistence, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### bfst_energy {.tabset .tabset-fade .tabset-pills}
**Энергичность**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$bfst_energy, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "bfst_energy"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$bfst_energy, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Энергичность", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$bfst_energy);print(st)
check_normal_distribution(st)
ks <- ks.test(df$bfst_energy, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(bfst_energy)$statistic,
          p.value = shapiro.test(bfst_energy)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = bfst_energy)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - bfst_energy", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(bfst_energy ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(bfst_energy ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, bfst_energy ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$bfst_energy)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$bfst_energy, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$bfst_energy, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "bfst_energy")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('bfst_energy', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=bfst_energy, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### bfst_empathy {.tabset .tabset-fade .tabset-pills}
**Сочувствие**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$bfst_empathy, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "bfst_empathy"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$bfst_empathy, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Сочувствие", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$bfst_empathy);print(st)
check_normal_distribution(st)
ks <- ks.test(df$bfst_empathy, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(bfst_empathy)$statistic,
          p.value = shapiro.test(bfst_empathy)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = bfst_empathy)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - bfst_empathy", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(bfst_empathy ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(bfst_empathy ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, bfst_empathy ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$bfst_empathy)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$bfst_empathy, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$bfst_empathy, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "bfst_empathy")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('bfst_empathy', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=bfst_empathy, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### bfst_respect {.tabset .tabset-fade .tabset-pills}
**Уважительность**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$bfst_respect, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "bfst_respect"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$bfst_respect, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Уважительность", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$bfst_respect);print(st)
check_normal_distribution(st)
ks <- ks.test(df$bfst_respect, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(bfst_respect)$statistic,
          p.value = shapiro.test(bfst_respect)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = bfst_respect)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - bfst_respect", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(bfst_respect ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(bfst_respect ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, bfst_respect ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$bfst_respect)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$bfst_respect, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$bfst_respect, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "bfst_respect")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('bfst_respect', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=bfst_respect, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### bfst_confidence {.tabset .tabset-fade .tabset-pills}
**Доверие**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$bfst_confidence, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "bfst_confidence"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$bfst_confidence, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Доверие", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$bfst_confidence);print(st)
check_normal_distribution(st)
ks <- ks.test(df$bfst_confidence, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(bfst_confidence)$statistic,
          p.value = shapiro.test(bfst_confidence)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = bfst_confidence)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - bfst_confidence", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(bfst_confidence ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(bfst_confidence ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, bfst_confidence ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$bfst_confidence)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$bfst_confidence, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$bfst_confidence, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "bfst_confidence")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('bfst_confidence', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=bfst_confidence, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### bfst_organization {.tabset .tabset-fade .tabset-pills}
**Организованность**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$bfst_organization, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "bfst_organization"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$bfst_organization, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Организованность", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$bfst_organization);print(st)
check_normal_distribution(st)
ks <- ks.test(df$bfst_organization, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(bfst_organization)$statistic,
          p.value = shapiro.test(bfst_organization)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = bfst_organization)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - bfst_organization", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(bfst_organization ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(bfst_organization ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, bfst_organization ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$bfst_organization)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$bfst_organization, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$bfst_organization, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "bfst_organization")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('bfst_organization', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=bfst_organization, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### bfst_productivity {.tabset .tabset-fade .tabset-pills}
**Продуктивность**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$bfst_productivity, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "bfst_productivity"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$bfst_productivity, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Продуктивность", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$bfst_productivity);print(st)
check_normal_distribution(st)
ks <- ks.test(df$bfst_productivity, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(bfst_productivity)$statistic,
          p.value = shapiro.test(bfst_productivity)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = bfst_productivity)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - bfst_productivity", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(bfst_productivity ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(bfst_productivity ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, bfst_productivity ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$bfst_productivity)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$bfst_productivity, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$bfst_productivity, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "bfst_productivity")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('bfst_productivity', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=bfst_productivity, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### bfst_responsibility {.tabset .tabset-fade .tabset-pills}
**Ответственность**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$bfst_responsibility, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "bfst_responsibility"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$bfst_responsibility, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Ответственность", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$bfst_responsibility);print(st)
check_normal_distribution(st)
ks <- ks.test(df$bfst_responsibility, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(bfst_responsibility)$statistic,
          p.value = shapiro.test(bfst_responsibility)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = bfst_responsibility)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - bfst_responsibility", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(bfst_responsibility ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(bfst_responsibility ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, bfst_responsibility ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$bfst_responsibility)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$bfst_responsibility, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$bfst_responsibility, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "bfst_responsibility")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('bfst_responsibility', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=bfst_responsibility, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### bfst_anxiety {.tabset .tabset-fade .tabset-pills}
**Тревожность**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$bfst_anxiety, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "bfst_anxiety"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$bfst_anxiety, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Тревожность", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$bfst_anxiety);print(st)
check_normal_distribution(st)
ks <- ks.test(df$bfst_anxiety, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(bfst_anxiety)$statistic,
          p.value = shapiro.test(bfst_anxiety)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = bfst_anxiety)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - bfst_anxiety", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(bfst_anxiety ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(bfst_anxiety ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, bfst_anxiety ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$bfst_anxiety)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$bfst_anxiety, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$bfst_anxiety, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "bfst_anxiety")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('bfst_anxiety', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=bfst_anxiety, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### bfst_depression {.tabset .tabset-fade .tabset-pills}
**Депрессивность**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$bfst_depression, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "bfst_depression"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$bfst_depression, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Депрессивность", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$bfst_depression);print(st)
check_normal_distribution(st)
ks <- ks.test(df$bfst_depression, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(bfst_depression)$statistic,
          p.value = shapiro.test(bfst_depression)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = bfst_depression)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - bfst_depression", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(bfst_depression ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(bfst_depression ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, bfst_depression ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$bfst_depression)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$bfst_depression, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$bfst_depression, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "bfst_depression")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('bfst_depression', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=bfst_depression, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### bfst_emotional_volatility {.tabset .tabset-fade .tabset-pills}
**Эмоциональная изменчивость**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$bfst_emotional_volatility, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "bfst_emotional_volatility"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$bfst_emotional_volatility, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Эмоциональная изменчивость", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$bfst_emotional_volatility);print(st)
check_normal_distribution(st)
ks <- ks.test(df$bfst_emotional_volatility, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(bfst_emotional_volatility)$statistic,
          p.value = shapiro.test(bfst_emotional_volatility)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = bfst_emotional_volatility)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - bfst_emotional_volatility", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(bfst_emotional_volatility ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(bfst_emotional_volatility ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, bfst_emotional_volatility ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$bfst_emotional_volatility)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$bfst_emotional_volatility, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$bfst_emotional_volatility, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "bfst_emotional_volatility")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('bfst_emotional_volatility', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=bfst_emotional_volatility, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### bfst_aesthetics {.tabset .tabset-fade .tabset-pills}
**Эстетичность**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$bfst_aesthetics, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "bfst_aesthetics"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$bfst_aesthetics, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Эстетичность", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$bfst_aesthetics);print(st)
check_normal_distribution(st)
ks <- ks.test(df$bfst_aesthetics, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(bfst_aesthetics)$statistic,
          p.value = shapiro.test(bfst_aesthetics)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = bfst_aesthetics)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - bfst_aesthetics", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(bfst_aesthetics ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(bfst_aesthetics ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, bfst_aesthetics ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$bfst_aesthetics)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$bfst_aesthetics, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$bfst_aesthetics, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "bfst_aesthetics")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('bfst_aesthetics', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=bfst_aesthetics, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### bfst_curiosity {.tabset .tabset-fade .tabset-pills}
**Любознательность**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$bfst_curiosity, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "bfst_curiosity"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$bfst_curiosity, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Любознательность", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$bfst_curiosity);print(st)
check_normal_distribution(st)
ks <- ks.test(df$bfst_curiosity, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(bfst_curiosity)$statistic,
          p.value = shapiro.test(bfst_curiosity)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = bfst_curiosity)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - bfst_curiosity", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(bfst_curiosity ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(bfst_curiosity ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, bfst_curiosity ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$bfst_curiosity)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$bfst_curiosity, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$bfst_curiosity, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "bfst_curiosity")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('bfst_curiosity', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=bfst_curiosity, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### bfst_personal_creativity {.tabset .tabset-fade .tabset-pills}
**Творческое воображение**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$bfst_personal_creativity, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "bfst_personal_creativity"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$bfst_personal_creativity, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Творческое воображение", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$bfst_personal_creativity);print(st)
check_normal_distribution(st)
ks <- ks.test(df$bfst_personal_creativity, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(bfst_personal_creativity)$statistic,
          p.value = shapiro.test(bfst_personal_creativity)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = bfst_personal_creativity)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - bfst_personal_creativity", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(bfst_personal_creativity ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(bfst_personal_creativity ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, bfst_personal_creativity ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$bfst_personal_creativity)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$bfst_personal_creativity, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$bfst_personal_creativity, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "bfst_personal_creativity")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('bfst_personal_creativity', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=bfst_personal_creativity, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```






### mrot_time_all {.tabset .tabset-fade .tabset-pills}
**Общее затраченное время на выполнение теста, сек**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$mrot_time_all, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "mrot_time_all"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$mrot_time_all, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Общее затраченное время на выполнение теста, сек", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$mrot_time_all);print(st)
check_normal_distribution(st)
ks <- ks.test(df$mrot_time_all, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(mrot_time_all)$statistic,
          p.value = shapiro.test(mrot_time_all)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = mrot_time_all)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - mrot_time_all", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(mrot_time_all ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(mrot_time_all ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, mrot_time_all ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$mrot_time_all)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$mrot_time_all, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$mrot_time_all, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "mrot_time_all")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('mrot_time_all', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=mrot_time_all, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### mrot_time_all_mean {.tabset .tabset-fade .tabset-pills}
**Среднее время на выполнение 1 задания всего теста, сек**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$mrot_time_all_mean, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "mrot_time_all_mean"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$mrot_time_all_mean, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Среднее время на выполнение 1 задания всего теста, сек", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$mrot_time_all_mean);print(st)
check_normal_distribution(st)
ks <- ks.test(df$mrot_time_all_mean, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(mrot_time_all_mean)$statistic,
          p.value = shapiro.test(mrot_time_all_mean)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = mrot_time_all_mean)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - mrot_time_all_mean", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(mrot_time_all_mean ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(mrot_time_all_mean ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, mrot_time_all_mean ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$mrot_time_all_mean)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$mrot_time_all_mean, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$mrot_time_all_mean, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "mrot_time_all_mean")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('mrot_time_all_mean', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=mrot_time_all_mean, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### mrot_time_all_sd {.tabset .tabset-fade .tabset-pills}
**Стандартное отклонение времени на 1 задание всего теста, сек**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$mrot_time_all_sd, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "mrot_time_all_sd"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$mrot_time_all_sd, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Стандартное отклонение времени на 1 задание всего теста, сек", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$mrot_time_all_sd);print(st)
check_normal_distribution(st)
ks <- ks.test(df$mrot_time_all_sd, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(mrot_time_all_sd)$statistic,
          p.value = shapiro.test(mrot_time_all_sd)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = mrot_time_all_sd)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - mrot_time_all_sd", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(mrot_time_all_sd ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(mrot_time_all_sd ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, mrot_time_all_sd ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$mrot_time_all_sd)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$mrot_time_all_sd, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$mrot_time_all_sd, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "mrot_time_all_sd")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('mrot_time_all_sd', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=mrot_time_all_sd, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### mrot_time_static {.tabset .tabset-fade .tabset-pills}
**Время на выполнение статической части теста, сек**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$mrot_time_static, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "mrot_time_static"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$mrot_time_static, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Время на выполнение статической части теста, сек", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$mrot_time_static);print(st)
check_normal_distribution(st)
ks <- ks.test(df$mrot_time_static, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(mrot_time_static)$statistic,
          p.value = shapiro.test(mrot_time_static)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = mrot_time_static)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - mrot_time_static", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(mrot_time_static ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(mrot_time_static ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, mrot_time_static ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$mrot_time_static)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$mrot_time_static, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$mrot_time_static, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "mrot_time_static")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('mrot_time_static', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=mrot_time_static, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### mrot_time_static_mean {.tabset .tabset-fade .tabset-pills}
**Среднее время на выполнение 1 задания cтатичной части теста, сек**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$mrot_time_static_mean, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "mrot_time_static_mean"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$mrot_time_static_mean, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Среднее время на выполнение 1 задания cтатичной части теста, сек", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$mrot_time_static_mean);print(st)
check_normal_distribution(st)
ks <- ks.test(df$mrot_time_static_mean, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(mrot_time_static_mean)$statistic,
          p.value = shapiro.test(mrot_time_static_mean)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = mrot_time_static_mean)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - mrot_time_static_mean", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(mrot_time_static_mean ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(mrot_time_static_mean ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, mrot_time_static_mean ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$mrot_time_static_mean)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$mrot_time_static_mean, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$mrot_time_static_mean, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "mrot_time_static_mean")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('mrot_time_static_mean', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=mrot_time_static_mean, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### mrot_time_static_sd {.tabset .tabset-fade .tabset-pills}
**Стандартное отклонение времени на 1 задание статичной части теста, сек**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$mrot_time_static_sd, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "mrot_time_static_sd"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$mrot_time_static_sd, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Стандартное отклонение времени на 1 задание статичной части теста, сек", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$mrot_time_static_sd);print(st)
check_normal_distribution(st)
ks <- ks.test(df$mrot_time_static_sd, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(mrot_time_static_sd)$statistic,
          p.value = shapiro.test(mrot_time_static_sd)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = mrot_time_static_sd)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - mrot_time_static_sd", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(mrot_time_static_sd ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(mrot_time_static_sd ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, mrot_time_static_sd ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$mrot_time_static_sd)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$mrot_time_static_sd, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$mrot_time_static_sd, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "mrot_time_static_sd")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('mrot_time_static_sd', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=mrot_time_static_sd, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### mrot_time_animation {.tabset .tabset-fade .tabset-pills}
**Время на выполнение анимированной части теста, сек**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$mrot_time_animation, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "mrot_time_animation"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$mrot_time_animation, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Время на выполнение анимированной части теста, сек", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$mrot_time_animation);print(st)
check_normal_distribution(st)
ks <- ks.test(df$mrot_time_animation, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(mrot_time_animation)$statistic,
          p.value = shapiro.test(mrot_time_animation)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = mrot_time_animation)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - mrot_time_animation", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(mrot_time_animation ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(mrot_time_animation ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, mrot_time_animation ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$mrot_time_animation)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$mrot_time_animation, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$mrot_time_animation, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "mrot_time_animation")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('mrot_time_animation', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=mrot_time_animation, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### mrot_time_animation_mean {.tabset .tabset-fade .tabset-pills}
**Среднее время на выполнение 1 задания анимированной части теста, сек**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$mrot_time_animation_mean, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "mrot_time_animation_mean"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$mrot_time_animation_mean, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Среднее время на выполнение 1 задания анимированной части теста, сек", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$mrot_time_animation_mean);print(st)
check_normal_distribution(st)
ks <- ks.test(df$mrot_time_animation_mean, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(mrot_time_animation_mean)$statistic,
          p.value = shapiro.test(mrot_time_animation_mean)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = mrot_time_animation_mean)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - mrot_time_animation_mean", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(mrot_time_animation_mean ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(mrot_time_animation_mean ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, mrot_time_animation_mean ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$mrot_time_animation_mean)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$mrot_time_animation_mean, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$mrot_time_animation_mean, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "mrot_time_animation_mean")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('mrot_time_animation_mean', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=mrot_time_animation_mean, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### mrot_time_animation_sd {.tabset .tabset-fade .tabset-pills}
**Стандартное отклонение времени на 1 задание анимированной части теста, сек**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$mrot_time_animation_sd, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "mrot_time_animation_sd"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$mrot_time_animation_sd, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Стандартное отклонение времени на 1 задание анимированной части теста, сек", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$mrot_time_animation_sd);print(st)
check_normal_distribution(st)
ks <- ks.test(df$mrot_time_animation_sd, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(mrot_time_animation_sd)$statistic,
          p.value = shapiro.test(mrot_time_animation_sd)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = mrot_time_animation_sd)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - mrot_time_animation_sd", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(mrot_time_animation_sd ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(mrot_time_animation_sd ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, mrot_time_animation_sd ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$mrot_time_animation_sd)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$mrot_time_animation_sd, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$mrot_time_animation_sd, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "mrot_time_animation_sd")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('mrot_time_animation_sd', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=mrot_time_animation_sd, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### mrot_right_all {.tabset .tabset-fade .tabset-pills}
**Количество верных ответов в тесте ментальное вращение**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$mrot_right_all, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "mrot_right_all"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$mrot_right_all, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Количество верных ответов в тесте ментальное вращение", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$mrot_right_all);print(st)
check_normal_distribution(st)
ks <- ks.test(df$mrot_right_all, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(mrot_right_all)$statistic,
          p.value = shapiro.test(mrot_right_all)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = mrot_right_all)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - mrot_right_all", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(mrot_right_all ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(mrot_right_all ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, mrot_right_all ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$mrot_right_all)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$mrot_right_all, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$mrot_right_all, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "mrot_right_all")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('mrot_right_all', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=mrot_right_all, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### mrot_right_static {.tabset .tabset-fade .tabset-pills}
**Количество верных ответов в статической части теста**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$mrot_right_static, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "mrot_right_static"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$mrot_right_static, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Количество верных ответов в статической части теста", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$mrot_right_static);print(st)
check_normal_distribution(st)
ks <- ks.test(df$mrot_right_static, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(mrot_right_static)$statistic,
          p.value = shapiro.test(mrot_right_static)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = mrot_right_static)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - mrot_right_static", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(mrot_right_static ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(mrot_right_static ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, mrot_right_static ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$mrot_right_static)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$mrot_right_static, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$mrot_right_static, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "mrot_right_static")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('mrot_right_static', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=mrot_right_static, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### mrot_right_animation {.tabset .tabset-fade .tabset-pills}
**Количество верных ответов в анимированной части теста**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$mrot_right_animation, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "mrot_right_animation"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$mrot_right_animation, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Количество верных ответов в анимированной части теста", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$mrot_right_animation);print(st)
check_normal_distribution(st)
ks <- ks.test(df$mrot_right_animation, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(mrot_right_animation)$statistic,
          p.value = shapiro.test(mrot_right_animation)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = mrot_right_animation)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - mrot_right_animation", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(mrot_right_animation ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(mrot_right_animation ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, mrot_right_animation ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$mrot_right_animation)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$mrot_right_animation, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$mrot_right_animation, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "mrot_right_animation")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('mrot_right_animation', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=mrot_right_animation, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### mrot_error_all {.tabset .tabset-fade .tabset-pills}
**Общее количество ошибок в тесте**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$mrot_error_all, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "mrot_error_all"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$mrot_error_all, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Общее количество ошибок в тесте", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$mrot_error_all);print(st)
check_normal_distribution(st)
ks <- ks.test(df$mrot_error_all, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(mrot_error_all)$statistic,
          p.value = shapiro.test(mrot_error_all)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = mrot_error_all)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - mrot_error_all", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(mrot_error_all ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(mrot_error_all ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, mrot_error_all ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$mrot_error_all)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$mrot_error_all, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$mrot_error_all, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "mrot_error_all")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('mrot_error_all', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=mrot_error_all, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### mrot_error_static {.tabset .tabset-fade .tabset-pills}
**Количество ошибок в статической части теста**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$mrot_error_static, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "mrot_error_static"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$mrot_error_static, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Количество ошибок в статической части теста", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$mrot_error_static);print(st)
check_normal_distribution(st)
ks <- ks.test(df$mrot_error_static, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(mrot_error_static)$statistic,
          p.value = shapiro.test(mrot_error_static)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = mrot_error_static)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - mrot_error_static", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(mrot_error_static ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(mrot_error_static ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, mrot_error_static ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$mrot_error_static)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$mrot_error_static, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$mrot_error_static, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "mrot_error_static")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('mrot_error_static', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=mrot_error_static, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### mrot_error_animation {.tabset .tabset-fade .tabset-pills}
**Количество ошибок в анимированной части теста**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$mrot_error_animation, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "mrot_error_animation"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$mrot_error_animation, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Количество ошибок в анимированной части теста", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$mrot_error_animation);print(st)
check_normal_distribution(st)
ks <- ks.test(df$mrot_error_animation, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(mrot_error_animation)$statistic,
          p.value = shapiro.test(mrot_error_animation)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = mrot_error_animation)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - mrot_error_animation", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(mrot_error_animation ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(mrot_error_animation ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, mrot_error_animation ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$mrot_error_animation)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$mrot_error_animation, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$mrot_error_animation, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "mrot_error_animation")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('mrot_error_animation', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=mrot_error_animation, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```






### vit_total {.tabset .tabset-fade .tabset-pills}
**Жизнестойкость**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$vit_total, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "vit_total"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$vit_total, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Жизнестойкость", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$vit_total);print(st)
check_normal_distribution(st)
ks <- ks.test(df$vit_total, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(vit_total)$statistic,
          p.value = shapiro.test(vit_total)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = vit_total)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - vit_total", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(vit_total ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(vit_total ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, vit_total ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$vit_total)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$vit_total, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$vit_total, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "vit_total")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('vit_total', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=vit_total, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### vit_involvement {.tabset .tabset-fade .tabset-pills}
**Вовлеченность**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$vit_involvement, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "vit_involvement"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$vit_involvement, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Вовлеченность", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$vit_involvement);print(st)
check_normal_distribution(st)
ks <- ks.test(df$vit_involvement, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(vit_involvement)$statistic,
          p.value = shapiro.test(vit_involvement)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = vit_involvement)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - vit_involvement", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(vit_involvement ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(vit_involvement ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, vit_involvement ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$vit_involvement)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$vit_involvement, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$vit_involvement, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "vit_involvement")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('vit_involvement', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=vit_involvement, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### vit_control {.tabset .tabset-fade .tabset-pills}
**Контроль**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$vit_control, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "vit_control"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$vit_control, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Контроль", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$vit_control);print(st)
check_normal_distribution(st)
ks <- ks.test(df$vit_control, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(vit_control)$statistic,
          p.value = shapiro.test(vit_control)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = vit_control)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - vit_control", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(vit_control ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(vit_control ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, vit_control ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$vit_control)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$vit_control, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$vit_control, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "vit_control")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('vit_control', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=vit_control, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### vit_risk {.tabset .tabset-fade .tabset-pills}
**Принятие риска**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$vit_risk, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "vit_risk"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$vit_risk, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Принятие риска", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$vit_risk);print(st)
check_normal_distribution(st)
ks <- ks.test(df$vit_risk, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(vit_risk)$statistic,
          p.value = shapiro.test(vit_risk)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = vit_risk)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - vit_risk", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(vit_risk ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(vit_risk ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, vit_risk ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$vit_risk)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$vit_risk, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$vit_risk, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "vit_risk")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('vit_risk', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=vit_risk, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### lc {.tabset .tabset-fade .tabset-pills}
**Локус контроля**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$lc, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "lc"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$lc, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Локус контроля", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$lc);print(st)
check_normal_distribution(st)
ks <- ks.test(df$lc, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(lc)$statistic,
          p.value = shapiro.test(lc)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = lc)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - lc", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(lc ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(lc ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, lc ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$lc)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$lc, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$lc, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "lc")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('lc', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=lc, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### soa_planfulness {.tabset .tabset-fade .tabset-pills}
**Планомерность**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$soa_planfulness, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "soa_planfulness"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$soa_planfulness, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Планомерность", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$soa_planfulness);print(st)
check_normal_distribution(st)
ks <- ks.test(df$soa_planfulness, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(soa_planfulness)$statistic,
          p.value = shapiro.test(soa_planfulness)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = soa_planfulness)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - soa_planfulness", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(soa_planfulness ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(soa_planfulness ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, soa_planfulness ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$soa_planfulness)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$soa_planfulness, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$soa_planfulness, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "soa_planfulness")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('soa_planfulness', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=soa_planfulness, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### soa_purposefulness {.tabset .tabset-fade .tabset-pills}
**Целеустремленность**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$soa_purposefulness, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "soa_purposefulness"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$soa_purposefulness, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Целеустремленность", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$soa_purposefulness);print(st)
check_normal_distribution(st)
ks <- ks.test(df$soa_purposefulness, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(soa_purposefulness)$statistic,
          p.value = shapiro.test(soa_purposefulness)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = soa_purposefulness)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - soa_purposefulness", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(soa_purposefulness ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(soa_purposefulness ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, soa_purposefulness ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$soa_purposefulness)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$soa_purposefulness, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$soa_purposefulness, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "soa_purposefulness")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('soa_purposefulness', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=soa_purposefulness, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### soa_persistence {.tabset .tabset-fade .tabset-pills}
**Настойчивость (SOA)**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$soa_persistence, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "soa_persistence"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$soa_persistence, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Настойчивость (SOA)", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$soa_persistence);print(st)
check_normal_distribution(st)
ks <- ks.test(df$soa_persistence, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(soa_persistence)$statistic,
          p.value = shapiro.test(soa_persistence)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = soa_persistence)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - soa_persistence", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(soa_persistence ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(soa_persistence ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, soa_persistence ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$soa_persistence)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$soa_persistence, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$soa_persistence, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "soa_persistence")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('soa_persistence', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=soa_persistence, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### soa_fixation {.tabset .tabset-fade .tabset-pills}
**Фиксация**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$soa_fixation, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "soa_fixation"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$soa_fixation, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Фиксация", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$soa_fixation);print(st)
check_normal_distribution(st)
ks <- ks.test(df$soa_fixation, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(soa_fixation)$statistic,
          p.value = shapiro.test(soa_fixation)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = soa_fixation)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - soa_fixation", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(soa_fixation ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(soa_fixation ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, soa_fixation ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$soa_fixation)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$soa_fixation, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$soa_fixation, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "soa_fixation")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('soa_fixation', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=soa_fixation, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### soa_organization {.tabset .tabset-fade .tabset-pills}
**Самоорганизация**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$soa_organization, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "soa_organization"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$soa_organization, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Самоорганизация", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$soa_organization);print(st)
check_normal_distribution(st)
ks <- ks.test(df$soa_organization, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(soa_organization)$statistic,
          p.value = shapiro.test(soa_organization)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = soa_organization)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - soa_organization", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(soa_organization ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(soa_organization ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, soa_organization ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$soa_organization)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$soa_organization, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$soa_organization, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "soa_organization")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('soa_organization', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=soa_organization, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### soa_present {.tabset .tabset-fade .tabset-pills}
**Ориентация на настоящее**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$soa_present, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "soa_present"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$soa_present, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Ориентация на настоящее", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$soa_present);print(st)
check_normal_distribution(st)
ks <- ks.test(df$soa_present, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(soa_present)$statistic,
          p.value = shapiro.test(soa_present)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = soa_present)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - soa_present", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(soa_present ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(soa_present ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, soa_present ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$soa_present)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$soa_present, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$soa_present, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "soa_present")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('soa_present', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=soa_present, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```






### kot_total {.tabset .tabset-fade .tabset-pills}
**Общий результат (KOT)**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$kot_total, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "kot_total"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$kot_total, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Общий результат (KOT)", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$kot_total);print(st)
check_normal_distribution(st)
ks <- ks.test(df$kot_total, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(kot_total)$statistic,
          p.value = shapiro.test(kot_total)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = kot_total)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - kot_total", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(kot_total ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(kot_total ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, kot_total ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$kot_total)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$kot_total, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$kot_total, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "kot_total")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('kot_total', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=kot_total, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### kot_verbal {.tabset .tabset-fade .tabset-pills}
**Анализ вербальной информации**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$kot_verbal, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "kot_verbal"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$kot_verbal, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Анализ вербальной информации", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$kot_verbal);print(st)
check_normal_distribution(st)
ks <- ks.test(df$kot_verbal, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(kot_verbal)$statistic,
          p.value = shapiro.test(kot_verbal)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = kot_verbal)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - kot_verbal", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(kot_verbal ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(kot_verbal ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, kot_verbal ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$kot_verbal)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$kot_verbal, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$kot_verbal, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "kot_verbal")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('kot_verbal', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=kot_verbal, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### kot_number {.tabset .tabset-fade .tabset-pills}
**Анализ числовой информации**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$kot_number, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "kot_number"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$kot_number, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Анализ числовой информации", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$kot_number);print(st)
check_normal_distribution(st)
ks <- ks.test(df$kot_number, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(kot_number)$statistic,
          p.value = shapiro.test(kot_number)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = kot_number)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - kot_number", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(kot_number ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(kot_number ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, kot_number ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$kot_number)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$kot_number, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$kot_number, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "kot_number")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('kot_number', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=kot_number, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### kot_attention {.tabset .tabset-fade .tabset-pills}
**Концентрация и распределение внимания**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$kot_attention, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "kot_attention"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$kot_attention, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Концентрация и распределение внимания", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$kot_attention);print(st)
check_normal_distribution(st)
ks <- ks.test(df$kot_attention, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(kot_attention)$statistic,
          p.value = shapiro.test(kot_attention)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = kot_attention)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - kot_attention", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(kot_attention ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(kot_attention ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, kot_attention ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$kot_attention)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$kot_attention, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$kot_attention, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "kot_attention")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('kot_attention', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=kot_attention, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### kot_spatial {.tabset .tabset-fade .tabset-pills}
**Пространственное мышление**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$kot_spatial, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "kot_spatial"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$kot_spatial, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Пространственное мышление", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$kot_spatial);print(st)
check_normal_distribution(st)
ks <- ks.test(df$kot_spatial, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(kot_spatial)$statistic,
          p.value = shapiro.test(kot_spatial)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = kot_spatial)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - kot_spatial", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(kot_spatial ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(kot_spatial ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, kot_spatial ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$kot_spatial)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$kot_spatial, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$kot_spatial, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "kot_spatial")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('kot_spatial', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=kot_spatial, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### kot_general {.tabset .tabset-fade .tabset-pills}
**Общая осведомленность**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$kot_general, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "kot_general"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$kot_general, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Общая осведомленность", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$kot_general);print(st)
check_normal_distribution(st)
ks <- ks.test(df$kot_general, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(kot_general)$statistic,
          p.value = shapiro.test(kot_general)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = kot_general)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - kot_general", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(kot_general ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(kot_general ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, kot_general ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$kot_general)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$kot_general, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$kot_general, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "kot_general")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('kot_general', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=kot_general, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```




### kot_logic {.tabset .tabset-fade .tabset-pills}
**Логика, дедуктивное мышление**

#### Descriptive stat by notcorr_kmdclust3
```{r}
desc_by_group <- describeBy(df$kot_logic, df$notcorr_kmdclust3, mat = T)
desc_by_group[order(desc_by_group$mean, decreasing = T),]
```

```{r fig.width=7, fig.height=4, results='asis'}
plot_title <- "kot_logic"
plot_list <- draw_plots_continuous_by_cluster(df, var = df$kot_logic, group = df$notcorr_kmdclust3, group_lab = "notcorr_kmdclust3", title = plot_title, legend_title = "notcorr_kmdclust3", x_lab = "Логика, дедуктивное мышление", filename = NULL, binwidth = NULL, bins = 15, alpha = 0.5, angle = 90)

create_tabs(plot_list)
```

#### Normal test
```{r}
st <- shapiro.test(df$kot_logic);print(st)
check_normal_distribution(st)
ks <- ks.test(df$kot_logic, "pnorm");print(ks)
check_normal_distribution(ks)
```

```{r}
tryCatch(
    expr = {
      df %>%
        group_by(notcorr_kmdclust3) %>%
        summarise(
          W = shapiro.test(kot_logic)$statistic,
          p.value = shapiro.test(kot_logic)$p.value,
          message = ifelse(p.value < 0.05, "Проверка на нормальность не пройдена", "Проверка на нормальность пройдена")
        )
    },
    error = function(e){
      print(e)
    }
)
```

```{r results='asis'}
p1 <- ggplot(df, aes(sample = kot_logic)) +  geom_qq(col=main_color) + geom_qq_line() + labs(title = "QQPlot - kot_logic", tabname="QQPlot", filename=paste0(plot_title, "_QQplot")) + facet_wrap(". ~ notcorr_kmdclust3")

create_tabs(list(p1))
```

#### ANOVA

```{r}
aov_model <- aov(kot_logic ~ notcorr_kmdclust3, data = df)
summary(aov_model)
```

#### Tables of means
```{r}
model.tables(aov_model, "means")
```

```{r}
tukey <- TukeyHSD(aov_model)
tukey
```


#### Post-hoc
```{r}
options(contrasts = c("contr.sum", "contr.poly"))
emm <- emmeans(aov_model, ~ notcorr_kmdclust3)
post_hoc <- data.frame(pairs(emm))
post_hoc[order(post_hoc$p.value),]
```

#### Significant differences

```{r}
apa_post_hoc(post_hoc)
```

#### Kruskal-Wallis Test

```{r}
kruskal_test <- kruskal.test(kot_logic ~ notcorr_kmdclust3, df)
kruskal_test
```

**Effect size**
```{r}
kruskal_effsize(df, kot_logic ~ notcorr_kmdclust3)
```

#### Pairwise comparison

```{r}
users_with_na <- df$user_id[is.na(df$kot_logic)]
df.test <- df[!df$user_id %in% users_with_na,]
df.test$user_id <- factor(df.test$user_id)

t_test_results <- pairwise.t.test(df.test$kot_logic, df.test$notcorr_kmdclust3, p.adjust.method = "BH");t_test_results
wilcox_test_results <- pairwise.wilcox.test(df.test$kot_logic, df.test$notcorr_kmdclust3, p.adjust.method = "BH");wilcox_test_results
```

```{r results='asis'}
if (sum(wilcox_test_results$p.value <= 0.05, na.rm = T) > 0) {
  sign_differences[["feature"]] <- c(sign_differences[["feature"]], "kot_logic")
  sign_differences[["p"]] <- c(sign_differences[["p"]], round(kruskal_test$p.value, 3))
  cat("<script>document.addEventListener('DOMContentLoaded', function() {addClassToTitle('kot_logic', 'highlight');});</script>")
}
```


#### CI ~ faculty
```{r}
pd = position_dodge(0.1)
ggplot(df, aes(x=notcorr_kmdclust3, y=kot_logic, color=notcorr_kmdclust3)) +
  stat_summary(fun.data = mean_cl_boot, geom="errorbar", width=0.3, lwd=0.8, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="line", size=1, position=pd, alpha=alpha) +
  stat_summary(fun.data = mean_cl_boot, geom="point", size=3, position = pd, pch = 15, alpha=alpha) + 
  theme(axis.text.x = element_text(angle = 90), legend.position = "none")
```









### Значимые различия
```{r results='asis'}
cat(paste0('<a href="#', sign_differences$feature, '">', sign_differences$feature, "</a><br>"))
```

```{r}
if (length(sign_differences) != 0) {
  df.sign_differences <- data.frame(sign_differences, analysis="notcorr_kmdclust3", filename = "5.15.2_sp_ds_acc_male_by_notcorr_kmdclust3")
} else {
  stop("В notcorr_kmdclust3 нет значимых различий!")
}

if (!"sign_differences.csv" %in% list.files("reports/")) {
  write.table(df.sign_differences, "./reports/sign_differences.csv", sep = ",", 
              append = F, row.names = F, col.names = T, quote = F)
} else {
  write.table(df.sign_differences, "./reports/sign_differences.csv", sep = ",",
              append = T, row.names = F, col.names = F, quote = F)
}
```
